# 1、关系模型

关系数据库是建立在关系模型上的，关系模型就是储存数据的二维表，类似于 Wxcel

表的每一行称为记录 `Record`

表的每一列称为字段 `Column`

所以每张表的每一行就是一条记录，每条记录由多个字段组成

字段定义了数据类型

如果为 `NULL` 则该字段数据不存在，值得注意的是，如果整型字段为 `NULL` 不代表该字段值为 `0`，同理如果字符串字段为 `NULL` 不代表该字段值为 `' '`

避免数据为 `NULL` 可以简化查询条件，加快查询速度，省去读取数据后再判断

与 Excel 有所不同，关系数据库的表与表之间需要建立“一对多”、“多对一”和“一对一”的关系，才能实现数据的操作

# 2、主键

在关系表中，任意两条记录是不能重复的，并且这个不重复必须存在一个字段来加以区分，这个字段就叫主键

记录一旦插入表中，就不要修改主键，因为主键是用来定位记录的，主键一旦改变，后果不堪设想

选取主键的原则是**不要选取与任何业务相关的字段**，包括像身份证、邮箱等看起来不会重复的字段，一般使用 `id`

id 字段主要有两种：

- 自增整数型：当数据库每插入一条记录，就添加一个自增整数到 id 字段作为主键

**注意：** 如果使用 INT 自增，表的记录最多只能到大约 21 亿条，而使用 BIGINT 自增则可以到大约 922 亿条

- 全局唯一 GUID 型：使用一种全局唯一的字符串作为主键，eg. `
8f55d96b-8acc-4636-8cb8-76bf8abc2f57`，它由 GUID 算法自动生成，大部分编程语言内置有 GUID 算法

# 3、联合主键

数据库允许使用多个字段来定位唯一记录，这些字段都是主键，即联合主键

联合主键可以每一列可以有重复字段，但是不能所有都有重复

不过实际使用时最好不要使用联合主键，会使关系表复杂度大大提高

# 4、外键

有了主键我们可以在数据库中确实唯一的一条记录，但是如何确定表与表之间的关系，就需要外键，把一张表的数据与另一张表关联起来

外键并不是通过列名即字段来实现的，而是通过单独的定义外键约束实现的

**添加外键：**

```sql
ALTER TABLE sheet1 # 选定数据表
ADD CONSTRAINT foreign_k # 外键约束的名称
FOREIGN KEY (first_id) # 指定 first_id 作为外键
REFERENCES sheet2 (sec_id) # 指定外键 first_id 与数据表 sheet2 的 sec_id 相关联
```

通过定义外键约束，关系数据库可以保证无法插入无效的数据，eg. sheet1 中没有 first_id = 100 这个记录，那么 sheet2 中就无法插入 sec_id = 99 的记录

使用外键约束会降低数据库的性能

**删除外键：**

```sql
ALTER TABLE sheet1 # 选定数据表
DROP FOREIGN KEY foreign_k # 删除外键约束
```

删除外键约束只是删除了外键约束这个定义，并没有删除外键这一列

一对一关系可以在数据表中直接增加一列数据，但是很多时候考虑到数据库的性能还是会把一对一的数据分成多个表存放


# 5、索引

索引可以加快数据库记录检索速度

如果某一列数据需要经常查询，就可以对这一列创建索引

```sql
ALTER TABLE sheet1 # 选定数据表
ADD INDEX idx_k (key); # 使用 key 列创建一个名为 idx_k 的索引
```

索引可以同时创建多列，eg.

```sql
ALTER TABLE sheet1 # 选定数据表
ADD INDEX idx_k (name, key);
```

索引的效率取决于索引列的值的相同程度，如果该列的值越不相同，索引的效率就越高

一张表可以创建多个索引，索引可以提高查询效率，但是在插入、删除、更新记录后，必须修改索引，所以索引越多，插入、删除、更新记录的效率就越低

**关系数据库会自动对主键创建索引，且主键会保持唯一，所以使用主键的效率最高**

主键最好不要使用任何与业务相关的列，但是既有业务要求，又具有唯一性的列，就可以作为**唯一索引**

```sql
ALTER TABLE sheet1 # 选定数据表
ADD UNIQUE INDEX idx_k (key); # 使用 key 列创建一个名为 idx_k 的唯一索引
```

也可以只对某一列创建一个唯一约束但不创建唯一索引

```sql
ALTER TABLE sheet1 # 选定数据表
ADD CONSTRAINT ind_x UNIQUE (key);
```

此时的 key 列并没有索引，但是具有唯一性

在使用数据库时，如果存在索引，数据库会自动使用索引来提高查询效率，就算没有索引，查询也能正常执行，只是速度没有那么快，索引可以在数据库的使用过程中慢慢优化
